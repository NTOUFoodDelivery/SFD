<!DOCTYPE HTML>
<!--
	Typify by TEMPLATED
	templated.co @templatedco
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>
<script src="js/jquery.min.js"></script>
<script src="js/skel.min.js"></script>
<script src="js/restaurant.js"></script>
<script>
	$(function(){
		$('#bu').click(function(){
			$('html,body').animate({scrollTop:$('#one').offset().top},800);});
	});

	$("#upload").click(function () {

		const id = '1573e8c523b6e8c'; // 填入 App 的 Client ID
		const token = '2288b6ecd6c0eb7545b4c083c9e0f212eb6ab9ed'; // 填入 token
		const album = 'vNnSeO4'; // 若要指定傳到某個相簿，就填入相簿的 ID

		var file_data = $('#myFile').prop('files')[0]; //取得上傳檔案屬性
		var text_data = $('#myText').val();

		let settings = {
			async: true,
			crossDomain: true,
			processData: false,
			contentType: false,
			type: 'POST',
			url: 'https://api.imgur.com/3/image',
			headers: {
				Authorization: 'Bearer ' + token
			},
			mimeType: 'multipart/form-data'
		};

		let form = new FormData();
		form.append('image', file_data);
		form.append('title', "123");
		form.append('description', text_data);
		form.append('album', album); // 有要指定的相簿就加這行

		settings.data = form;

		$.ajax(settings).done(function(res) {
			console.log(res); // 可以看見上傳成功後回的值
			console.log(JSON.parse(res).data.link); // ------------------------- 圖片網址
			alert('上傳完成，稍待一會兒就可以在底部的列表上看見了。')
		});
	})

			 function add()
			 {
				 var restName = $('#restName').val()
				 var restAddress = $('#restAddress').val()
				 var restDescription = $('#restDescription').val()
				 const dateTime = new Date().getTime();
				 const timestamp = Math.floor(dateTime / 1000);
				 console.log(timestamp);
				 console.log(restName);
				 console.log(restAddress);
				 console.log(restDescription);
				 var sJson = JSON.stringify
				 ({
					 Rest_ID: timestamp,
					 Rest_Name: restName,
					 Rest_Address: restAddress,
					 Description: restDescription
				 });
				 $.ajax({
					 url: "https://ntou-sfd.herokuapp.com/ModifyRestInfoServlet?cmd=ADD",
					 type: "POST",
					 async: true,
					 dataType: "json",
					 contentType: 'application/json; charset=UTF-8',
					 data: sJson,
					 success: function(){alert("Sussess")}		});
			 }

			 function delete_rest()
			 {
				 var optionSelected = $("option:selected", $('#restaurant_select'));
				 var deleteID = optionSelected[0].id.split("delete")[1];
				 console.log(deleteID);
				 var restID = deleteID;
				 var sJson = JSON.stringify
				 ({
					 Rest_ID: restID,
				 });
				 $.ajax({
					 url: "https://ntou-sfd.herokuapp.com/ModifyRestInfoServlet?cmd=DELETE",
					 type: "POST",
					 async: true,
					 dataType: "json",
					 contentType: 'application/json; charset=UTF-8',
					 data: sJson,
					 success: function(){alert("Sussess")}		});
			 }

			 function fix_rest() {
				 var optionSelected = $("option:selected", $('#restaurant_select1'));
				 var fixID = optionSelected[0].id.split("delete")[1];
				 ;
				 console.log(fixID);
				 var restID = fixID;
				 var restName = $('#restName').val()
				 var restAddress = $('#restAddress').val()
				 var restDescription = $('#restDescription').val()
				 var sJson = JSON.stringify
				 ({
					 Rest_ID: fixID,
					 Rest_Name: restName,
					 Rest_Address:restAddress,
					 Description: restDescription
				 });
				 $.ajax({
					 url: "https://ntou-sfd.herokuapp.com/ModifyRestInfoServlet?cmd=EDIT",
					 type: "POST",
					 async: true,
					 dataType: "json",
					 contentType: 'application/json; charset=UTF-8',
					 data: sJson,
					 success: function () {
						 alert("Sussess")
					 }
				 });
			 }
		</script>
	<head>
		<title>新增刪除修改餐廳資訊</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="css/main.css" />
		<script src="js/admin.js"></script>
	</head>

	<body>

		<!-- Banner -->
			<section id="banner">
				<h2><strong>Starburst Food Delivery</strong></h2>
				<p>新增刪除修改餐廳資訊介面</p>
				<p>AAAAA管理員</p>
				<ul class="actions">
					<li><a id = "bu" href="#" class="button special">開始使用</a></li>
				</ul>
			</section>

		<!-- One -->
			<section id="one" class="wrapper special">
				<div class="inner">
					<header class="major">
						<h2>新增餐廳</h2>
					</header>
					<div class="features">
						<div class="feature">
							<p>餐廳名稱</p>
							<input id="restName" type="text" ></input>
							<p></p>
						</div>
						<div class="feature">
							<p>餐廳地址</p>
							<input id="restAddress" type="text" ></input>
							<p></p>
						</div>
						<div class="feature">
							<p>敘述</p>
							<input id="restDescription" type="text" ></input>
							<p></p>
						</div>
						<div class="feature">
							<p>餐廳照片</p>
							<input type="text" id="myText" />
							<input type="file" id="myFile" accept="image/*" />
							<!--<input data-dismiss="modal" id="upload" type="submit" />-->
							<input type="button" value="前往!" id="go" onclick="upload()"/>
							<p></p>
						</div>
					</div>
				</div>
				<a href = "javascript:add()" class="button special">確定</a>
			</section>
			
			<section id="banner1" class="wrapper special">
				<div class="inner">
					<header class="major">
						<h2>刪除餐廳</h2>
					</header>
					<div class="features">
						<div class="feature">
							<p>選擇餐廳</p>
							<select id='restaurant_select'>
							</select>
							<p></p>
							<h3><a href = "javascript:delete_rest()" class="button special">確定</a></h3>
						</div>
					</div>
				</div>
			</section>
			
			<section id="three" class="wrapper special">
				<div class="inner">
					<header class="major">
						<h2>修改餐廳</h2>
					</header>
					<div class="features">
						<div class="feature">
							<p>選擇餐廳</p>
							<select id='restaurant_select1'>
							</select>
							<p></p>
							<h3><a class="button special">確定</a></h3>
						</div>
						<div class="feature">
							<p>餐廳名稱</p>
							<input id="restName" type="text" ></input>
							<p></p>
						</div>
						<div class="feature">
							<p>餐廳地址</p>
							<input id="restAddress" type="text" ></input>
							<p></p>
						</div>
						<div class="feature">
							<p>敘述</p>
							<input id="restDescription" type="text" ></input>
							<p></p>
						</div>
						<div class="feature">
							<p>餐廳照片</p>
							<input type="text" id="myText" />
							<input type="file" id="myFile" accept="image/*" />
							<input data-dismiss="modal" id="upload" type="submit" />
							<p></p>
						</div>
					</div>
				</div>
				<a href = "javascript:fix_rest()" class="button special">確定</a>
			</section>
		<!-- Footer -->
			<footer id="footer">
				<div class="copyright">
					&copy; 製作: <a href="https://trello.com/b/6JldUO2i/%E6%B5%B7%E5%A4%A7%E9%A4%90%E9%A3%B2%E5%A4%96%E9%80%81%E7%B3%BB%E7%B5%B1">SFD製作委員會</a>.
				</div>
			</footer>

		<!-- Scripts -->

	</body>
</html>